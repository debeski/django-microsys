{% load static %}
<!-- Autofill Toggle for Titlebar -->
<div class="form-check form-switch d-flex align-items-center me-2" title="التعبئة التلقائية">
    <input class="form-check-input" type="checkbox" id="autofillToggle" style="cursor: pointer;">
    <label class="form-check-label ms-1 d-none d-md-inline small" for="autofillToggle" style="cursor: pointer;">تعبئة تلقائية</label>
</div>

<!-- Load Autofill Logic -->
<script src="{% static 'main/js/autofill.js' %}" nonce="{{ request.csp_nonce }}" defer></script>

<script nonce="{{ request.csp_nonce }}">
    document.addEventListener('DOMContentLoaded', function() {
        const toggle = document.getElementById('autofillToggle');
        if (!toggle) return;
        
        // Ensure form in main content has metadata for autofill
        const form = document.querySelector('#mainContent form');
        if (form) {
            // Try to set model info from view context if available
            {% if view.model %}
            form.dataset.appLabel = "{{ view.model._meta.app_label }}";
            form.dataset.modelName = "{{ view.model._meta.model_name }}";
            {% elif object %}
            form.dataset.appLabel = "{{ object._meta.app_label }}";
            form.dataset.modelName = "{{ object._meta.model_name }}";
            {% endif %}
            
            // Allow manual override or fallback via data attributes rendered directly on form in template
            // (If the template itself specifies it, we don't overwrite)
        }
    });
</script>
